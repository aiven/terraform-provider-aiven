// Copyright (c) 2026 Aiven, Helsinki, Finland. https://aiven.io/
// Code generated by user config generator. DO NOT EDIT.

package billinggroup

import (
	"context"
	"fmt"
	"path/filepath"
	"strings"

	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"

	"github.com/aiven/terraform-provider-aiven/internal/plugin/util"
)

const typeName = "aiven_billing_group"

type tfModel struct {
	ID                   types.String `tfsdk:"id"`
	AccountID            types.String `tfsdk:"account_id"`
	AddressLines         types.Set    `tfsdk:"address_lines"`
	BillingContactEmails types.Set    `tfsdk:"billing_contact_emails"`
	BillingCurrency      types.String `tfsdk:"billing_currency"`
	BillingEmails        types.Set    `tfsdk:"billing_emails"`
	BillingExtraText     types.String `tfsdk:"billing_extra_text"`
	BillingGroupID       types.String `tfsdk:"billing_group_id"`
	CardID               types.String `tfsdk:"card_id"`
	City                 types.String `tfsdk:"city"`
	Company              types.String `tfsdk:"company"`
	CopyFromBillingGroup types.String `tfsdk:"copy_from_billing_group"`
	CountryCode          types.String `tfsdk:"country_code"`
	Name                 types.String `tfsdk:"name"`
	ParentID             types.String `tfsdk:"parent_id"`
	State                types.String `tfsdk:"state"`
	VatID                types.String `tfsdk:"vat_id"`
	ZipCode              types.String `tfsdk:"zip_code"`
}

func (tf *tfModel) SetID(vBillingGroupID string) {
	tf.BillingGroupID = types.StringValue(vBillingGroupID)
	tf.ID = types.StringValue(filepath.Join(vBillingGroupID))
}

type apiModel struct {
	AccountID            *string   `json:"account_id,omitempty"`
	AddressLines         *[]string `json:"address_lines,omitempty"`
	BillingContactEmails *[]string `json:"billing_contact_emails,omitempty"`
	BillingCurrency      *string   `json:"billing_currency,omitempty"`
	BillingEmails        *[]string `json:"billing_emails,omitempty"`
	BillingExtraText     *string   `json:"billing_extra_text,omitempty"`
	BillingGroupID       *string   `json:"billing_group_id,omitempty"`
	CardID               *string   `json:"card_id,omitempty"`
	City                 *string   `json:"city,omitempty"`
	Company              *string   `json:"company,omitempty"`
	CopyFromBillingGroup *string   `json:"copy_from_billing_group,omitempty"`
	CountryCode          *string   `json:"country_code,omitempty"`
	Name                 *string   `json:"billing_group_name,omitempty"`
	ParentID             *string   `json:"parent_id,omitempty"`
	State                *string   `json:"state,omitempty"`
	VatID                *string   `json:"vat_id,omitempty"`
	ZipCode              *string   `json:"zip_code,omitempty"`
}

// idFields the ID attribute fields, i.e.:
// terraform import aiven_billing_group.foo BILLING_GROUP_ID
func idFields() []string {
	return []string{"billing_group_id"}
}

// expandData turns TF object into Request
func expandData[R any](ctx context.Context, plan, state *tfModel, req *R, modifiers ...util.MapModifier[tfModel]) diag.Diagnostics {
	api := new(apiModel)
	if !plan.AddressLines.IsNull() || state != nil && !state.AddressLines.IsNull() {
		vAddressLines := make([]string, 0)
		diags := plan.AddressLines.ElementsAs(ctx, &vAddressLines, false)
		if diags.HasError() {
			return diags
		}
		api.AddressLines = &vAddressLines
	}
	if !plan.BillingContactEmails.IsNull() || state != nil && !state.BillingContactEmails.IsNull() {
		vBillingContactEmails := make([]string, 0)
		diags := plan.BillingContactEmails.ElementsAs(ctx, &vBillingContactEmails, false)
		if diags.HasError() {
			return diags
		}
		api.BillingContactEmails = &vBillingContactEmails
	}
	if !plan.BillingEmails.IsNull() || state != nil && !state.BillingEmails.IsNull() {
		vBillingEmails := make([]string, 0)
		diags := plan.BillingEmails.ElementsAs(ctx, &vBillingEmails, false)
		if diags.HasError() {
			return diags
		}
		api.BillingEmails = &vBillingEmails
	}
	if !plan.AccountID.IsNull() && !plan.AccountID.IsUnknown() {
		vAccountID := plan.AccountID.ValueString()
		api.AccountID = &vAccountID
	}
	if !plan.BillingCurrency.IsNull() && !plan.BillingCurrency.IsUnknown() {
		vBillingCurrency := plan.BillingCurrency.ValueString()
		api.BillingCurrency = &vBillingCurrency
	}
	if !plan.BillingExtraText.IsNull() || state != nil && !state.BillingExtraText.IsNull() {
		vBillingExtraText := plan.BillingExtraText.ValueString()
		api.BillingExtraText = &vBillingExtraText
	}
	if !plan.CardID.IsNull() || state != nil && !state.CardID.IsNull() {
		vCardID := plan.CardID.ValueString()
		api.CardID = &vCardID
	}
	if !plan.City.IsNull() && !plan.City.IsUnknown() {
		vCity := plan.City.ValueString()
		api.City = &vCity
	}
	if !plan.Company.IsNull() && !plan.Company.IsUnknown() {
		vCompany := plan.Company.ValueString()
		api.Company = &vCompany
	}
	if !plan.CopyFromBillingGroup.IsNull() || state != nil && !state.CopyFromBillingGroup.IsNull() {
		vCopyFromBillingGroup := plan.CopyFromBillingGroup.ValueString()
		api.CopyFromBillingGroup = &vCopyFromBillingGroup
	}
	if !plan.CountryCode.IsNull() && !plan.CountryCode.IsUnknown() {
		vCountryCode := plan.CountryCode.ValueString()
		api.CountryCode = &vCountryCode
	}
	if !plan.Name.IsNull() || state != nil && !state.Name.IsNull() {
		vName := plan.Name.ValueString()
		api.Name = &vName
	}
	if !plan.ParentID.IsNull() || state != nil && !state.ParentID.IsNull() {
		vParentID := plan.ParentID.ValueString()
		api.ParentID = &vParentID
	}
	if !plan.State.IsNull() || state != nil && !state.State.IsNull() {
		vState := plan.State.ValueString()
		api.State = &vState
	}
	if !plan.VatID.IsNull() && !plan.VatID.IsUnknown() {
		vVatID := plan.VatID.ValueString()
		api.VatID = &vVatID
	}
	if !plan.ZipCode.IsNull() || state != nil && !state.ZipCode.IsNull() {
		vZipCode := plan.ZipCode.ValueString()
		api.ZipCode = &vZipCode
	}
	err := util.Remarshal(api, req, plan, modifiers...)
	if err != nil {
		var diags diag.Diagnostics
		diags.AddError("Remarshal error", fmt.Sprintf("Failed to remarshal dtoModel to Request: %s", err.Error()))
		return diags
	}
	return nil
}

// flattenData turns Response into TF object
func flattenData[R any](ctx context.Context, state *tfModel, rsp *R, modifiers ...util.MapModifier[tfModel]) diag.Diagnostics {
	api := new(apiModel)
	err := util.Remarshal(rsp, api, state, modifiers...)
	if err != nil {
		var diags diag.Diagnostics
		diags.AddError("Remarshal error", fmt.Sprintf("Failed to remarshal Response to dtoModel: %s", err.Error()))
		return diags
	}
	if api.AddressLines != nil && !state.AddressLines.IsUnknown() {
		vAddressLines, diags := util.SetValueFrom(ctx, types.StringType, api.AddressLines)
		if diags.HasError() {
			return diags
		}
		state.AddressLines = vAddressLines
	}
	if api.BillingContactEmails != nil && !state.BillingContactEmails.IsUnknown() {
		vBillingContactEmails, diags := util.SetValueFrom(ctx, types.StringType, api.BillingContactEmails)
		if diags.HasError() {
			return diags
		}
		state.BillingContactEmails = vBillingContactEmails
	}
	if api.BillingEmails != nil && !state.BillingEmails.IsUnknown() {
		vBillingEmails, diags := util.SetValueFrom(ctx, types.StringType, api.BillingEmails)
		if diags.HasError() {
			return diags
		}
		state.BillingEmails = vBillingEmails
	}
	if api.AccountID != nil || state.AccountID.IsUnknown() {
		state.AccountID = util.StringPointerValue(api.AccountID)
	}
	if api.BillingCurrency != nil || state.BillingCurrency.IsUnknown() {
		state.BillingCurrency = util.StringPointerValue(api.BillingCurrency)
	}
	if api.BillingExtraText != nil && !state.BillingExtraText.IsUnknown() {
		state.BillingExtraText = util.StringPointerValue(api.BillingExtraText)
	}
	if api.BillingGroupID != nil || state.BillingGroupID.IsUnknown() {
		state.BillingGroupID = util.StringPointerValue(api.BillingGroupID)
	}
	if api.CardID != nil && !state.CardID.IsUnknown() {
		state.CardID = util.StringPointerValue(api.CardID)
	}
	if api.City != nil || state.City.IsUnknown() {
		state.City = util.StringPointerValue(api.City)
	}
	if api.Company != nil || state.Company.IsUnknown() {
		state.Company = util.StringPointerValue(api.Company)
	}
	if api.CopyFromBillingGroup != nil && !state.CopyFromBillingGroup.IsUnknown() {
		state.CopyFromBillingGroup = util.StringPointerValue(api.CopyFromBillingGroup)
	}
	if api.CountryCode != nil || state.CountryCode.IsUnknown() {
		state.CountryCode = util.StringPointerValue(api.CountryCode)
	}
	if api.Name != nil && !state.Name.IsUnknown() {
		state.Name = util.StringPointerValue(api.Name)
	}
	if api.ParentID != nil && !state.ParentID.IsUnknown() {
		state.ParentID = util.StringPointerValue(api.ParentID)
	}
	if api.State != nil && !state.State.IsUnknown() {
		state.State = util.StringPointerValue(api.State)
	}
	if api.VatID != nil || state.VatID.IsUnknown() {
		state.VatID = util.StringPointerValue(api.VatID)
	}
	if api.ZipCode != nil && !state.ZipCode.IsUnknown() {
		state.ZipCode = util.StringPointerValue(api.ZipCode)
	}
	// Response may not contain ID fields.
	// In that case, `terraform import` won't be able to set them. Gets values from the ID.
	if state.ID.ValueString() != "" {
		var parts [1]string
		for i, v := range strings.SplitN(state.ID.ValueString(), "/", 1) {
			parts[i] = v
		}
		if state.BillingGroupID.ValueString() == "" {
			state.BillingGroupID = types.StringValue(parts[0])
		}
	}
	state.SetID(state.BillingGroupID.ValueString())
	return nil
}
