// Copyright (c) 2025 Aiven, Helsinki, Finland. https://aiven.io/
// Code generated by user config generator. DO NOT EDIT.

package address

import (
	"context"
	"fmt"
	"path/filepath"
	"strings"

	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"

	"github.com/aiven/terraform-provider-aiven/internal/plugin/util"
)

func idFields() []string {
	return []string{"organization_id", "address_id"}
}

// dataModel Gets information about an organization address.
type dataModel struct {
	ID             types.String `tfsdk:"id"`
	AddressID      types.String `tfsdk:"address_id"`
	AddressLines   types.Set    `tfsdk:"address_lines"`
	City           types.String `tfsdk:"city"`
	CountryCode    types.String `tfsdk:"country_code"`
	CreateTime     types.String `tfsdk:"create_time"`
	Name           types.String `tfsdk:"name"`
	OrganizationID types.String `tfsdk:"organization_id"`
	State          types.String `tfsdk:"state"`
	UpdateTime     types.String `tfsdk:"update_time"`
	ZipCode        types.String `tfsdk:"zip_code"`
}

func (data *dataModel) SetID(vOrganizationID string, vAddressID string) {
	data.OrganizationID = types.StringValue(vOrganizationID)
	data.AddressID = types.StringValue(vAddressID)
	data.ID = types.StringValue(filepath.Join(vOrganizationID, vAddressID))
}

type dtoModel struct {
	AddressID      *string   `json:"address_id,omitempty"`
	AddressLines   *[]string `json:"address_lines,omitempty"`
	City           *string   `json:"city,omitempty"`
	CountryCode    *string   `json:"country_code,omitempty"`
	CreateTime     *string   `json:"create_time,omitempty"`
	Name           *string   `json:"name,omitempty"`
	OrganizationID *string   `json:"organization_id,omitempty"`
	State          *string   `json:"state,omitempty"`
	UpdateTime     *string   `json:"update_time,omitempty"`
	ZipCode        *string   `json:"zip_code,omitempty"`
}

// expandData turns TF object into Request
func expandData[R any](ctx context.Context, plan, state *dataModel, rqs *R, modifiers ...util.MapModifier[dtoModel]) diag.Diagnostics {
	dto := new(dtoModel)
	if !plan.AddressLines.IsNull() || state != nil && !state.AddressLines.IsNull() {
		vAddressLines := make([]string, 0)
		diags := plan.AddressLines.ElementsAs(ctx, &vAddressLines, false)
		if diags.HasError() {
			return diags
		}
		dto.AddressLines = &vAddressLines
	}
	if !plan.City.IsNull() || state != nil && !state.City.IsNull() {
		vCity := plan.City.ValueString()
		dto.City = &vCity
	}
	if !plan.CountryCode.IsNull() || state != nil && !state.CountryCode.IsNull() {
		vCountryCode := plan.CountryCode.ValueString()
		dto.CountryCode = &vCountryCode
	}
	if !plan.Name.IsNull() || state != nil && !state.Name.IsNull() {
		vName := plan.Name.ValueString()
		dto.Name = &vName
	}
	if !plan.OrganizationID.IsNull() || state != nil && !state.OrganizationID.IsNull() {
		vOrganizationID := plan.OrganizationID.ValueString()
		dto.OrganizationID = &vOrganizationID
	}
	if !plan.State.IsNull() || state != nil && !state.State.IsNull() {
		vState := plan.State.ValueString()
		dto.State = &vState
	}
	if !plan.ZipCode.IsNull() || state != nil && !state.ZipCode.IsNull() {
		vZipCode := plan.ZipCode.ValueString()
		dto.ZipCode = &vZipCode
	}
	err := util.Unmarshal(dto, rqs, modifiers...)
	if err != nil {
		var diags diag.Diagnostics
		diags.AddError("Unmarshal error", fmt.Sprintf("Failed to unmarshal dtoModel to Request: %s", err.Error()))
		return diags
	}
	return nil
}

// flattenData turns Response into TF object
func flattenData[R any](ctx context.Context, state *dataModel, rsp *R, modifiers ...util.MapModifier[R]) diag.Diagnostics {
	dto := new(dtoModel)
	err := util.Unmarshal(rsp, dto, modifiers...)
	if err != nil {
		var diags diag.Diagnostics
		diags.AddError("Unmarshal error", fmt.Sprintf("Failed to unmarshal Response to dtoModel: %s", err.Error()))
		return diags
	}
	if dto.AddressLines != nil && (len(*dto.AddressLines) > 0 || !state.AddressLines.IsNull()) {
		vAddressLines, diags := types.SetValueFrom(ctx, types.StringType, dto.AddressLines)
		if diags.HasError() {
			return diags
		}
		state.AddressLines = vAddressLines
	}
	if dto.AddressID != nil && (*dto.AddressID != "" || !state.AddressID.IsNull()) {
		state.AddressID = types.StringPointerValue(dto.AddressID)
	}
	if dto.City != nil && (*dto.City != "" || !state.City.IsNull()) {
		state.City = types.StringPointerValue(dto.City)
	}
	if dto.CountryCode != nil && (*dto.CountryCode != "" || !state.CountryCode.IsNull()) {
		state.CountryCode = types.StringPointerValue(dto.CountryCode)
	}
	if dto.CreateTime != nil && (*dto.CreateTime != "" || !state.CreateTime.IsNull()) {
		state.CreateTime = types.StringPointerValue(dto.CreateTime)
	}
	if dto.Name != nil && (*dto.Name != "" || !state.Name.IsNull()) {
		state.Name = types.StringPointerValue(dto.Name)
	}
	if dto.OrganizationID != nil && (*dto.OrganizationID != "" || !state.OrganizationID.IsNull()) {
		state.OrganizationID = types.StringPointerValue(dto.OrganizationID)
	}
	if dto.State != nil && (*dto.State != "" || !state.State.IsNull()) {
		state.State = types.StringPointerValue(dto.State)
	}
	if dto.UpdateTime != nil && (*dto.UpdateTime != "" || !state.UpdateTime.IsNull()) {
		state.UpdateTime = types.StringPointerValue(dto.UpdateTime)
	}
	if dto.ZipCode != nil && (*dto.ZipCode != "" || !state.ZipCode.IsNull()) {
		state.ZipCode = types.StringPointerValue(dto.ZipCode)
	}
	// Response may not contain ID fields.
	// In that case, `terraform import` won't be able to set them. Gets values from the ID.
	if state.ID.ValueString() != "" {
		var parts [2]string
		for i, v := range strings.SplitN(state.ID.ValueString(), "/", 2) {
			parts[i] = v
		}
		if state.OrganizationID.ValueString() == "" {
			state.OrganizationID = types.StringValue(parts[0])
		}
		if state.AddressID.ValueString() == "" {
			state.AddressID = types.StringValue(parts[1])
		}
	}
	state.SetID(state.OrganizationID.ValueString(), state.AddressID.ValueString())
	return nil
}
