// Copyright (c) 2025 Aiven, Helsinki, Finland. https://aiven.io/
// Code generated by user config generator. DO NOT EDIT.

package userlist

import (
	"context"

	avngen "github.com/aiven/go-client-codegen"
	"github.com/hashicorp/terraform-plugin-framework-validators/datasourcevalidator"
	"github.com/hashicorp/terraform-plugin-framework/datasource"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/path"

	"github.com/aiven/terraform-provider-aiven/internal/plugin/adapter"
	"github.com/aiven/terraform-provider-aiven/internal/plugin/errmsg"
)

var DataSourceOptions = adapter.DataSourceOptions[*datasourceModel, tfModel]{
	ConfigValidators: datasourceConfigValidators,
	Read:             readView,
	Schema:           datasourceSchema,
	TypeName:         typeName,
}

func readView(ctx context.Context, client avngen.Client, state *tfModel) diag.Diagnostics {
	var diags diag.Diagnostics
	diags.Append(planModifier(ctx, client, state)...)
	if diags.HasError() {
		return diags
	}
	func() {
		rsp, err := client.OrganizationUserList(ctx, state.ID.ValueString())
		if err != nil {
			diags.Append(errmsg.FromError("OrganizationUserList Error", err))
			return
		}
		diags.Append(flattenData(ctx, state, &map[string]any{"users": rsp})...)
	}()
	return diags
}

func datasourceConfigValidators(ctx context.Context, client avngen.Client) []datasource.ConfigValidator {
	return []datasource.ConfigValidator{
		datasourcevalidator.ExactlyOneOf(
			path.MatchRoot("id"),
			path.MatchRoot("name"),
		),
	}
}
