// Copyright (c) 2025 Aiven, Helsinki, Finland. https://aiven.io/
// Code generated by user config generator. DO NOT EDIT.

package usergrouplist

import (
	"context"
	"fmt"
	"path/filepath"
	"strings"

	"github.com/hashicorp/terraform-plugin-framework/attr"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"

	"github.com/aiven/terraform-provider-aiven/internal/plugin/util"
)

const typeName = "aiven_organization_user_group_list"

type tfModel struct {
	ID             types.String `tfsdk:"id"`
	OrganizationID types.String `tfsdk:"organization_id"`
	UserGroups     types.Set    `tfsdk:"user_groups"`
}

func (tf *tfModel) SetID(vOrganizationID string) {
	tf.OrganizationID = types.StringValue(vOrganizationID)
	tf.ID = types.StringValue(filepath.Join(vOrganizationID))
}

type tfModelUserGroups struct {
	CreateTime    types.String `tfsdk:"create_time"`
	Description   types.String `tfsdk:"description"`
	ManagedByScim types.Bool   `tfsdk:"managed_by_scim"`
	MemberCount   types.Int64  `tfsdk:"member_count"`
	UpdateTime    types.String `tfsdk:"update_time"`
	UserGroupID   types.String `tfsdk:"user_group_id"`
	UserGroupName types.String `tfsdk:"user_group_name"`
}

type apiModel struct {
	OrganizationID *string                `json:"organization_id,omitempty"`
	UserGroups     *[]*apiModelUserGroups `json:"user_groups,omitempty"`
}

type apiModelUserGroups struct {
	CreateTime    *string `json:"create_time,omitempty"`
	Description   *string `json:"description,omitempty"`
	ManagedByScim *bool   `json:"managed_by_scim,omitempty"`
	MemberCount   *int64  `json:"member_count,omitempty"`
	UpdateTime    *string `json:"update_time,omitempty"`
	UserGroupID   *string `json:"user_group_id,omitempty"`
	UserGroupName *string `json:"user_group_name,omitempty"`
}

// flattenData turns Response into TF object
func flattenData[R any](ctx context.Context, state *tfModel, rsp *R, modifiers ...util.MapModifier[tfModel]) diag.Diagnostics {
	api := new(apiModel)
	err := util.Remarshal(rsp, api, state, modifiers...)
	if err != nil {
		var diags diag.Diagnostics
		diags.AddError("Remarshal error", fmt.Sprintf("Failed to remarshal Response to dtoModel: %s", err.Error()))
		return diags
	}
	if api.UserGroups != nil {
		vUserGroups, diags := util.FlattenSetNested(ctx, flattenUserGroups, *api.UserGroups, attrsUserGroups())
		if diags.HasError() {
			return diags
		}
		state.UserGroups = vUserGroups
	}
	if api.OrganizationID != nil {
		state.OrganizationID = util.StringPointerValue(api.OrganizationID)
	}
	// Response may not contain ID fields.
	// In that case, `terraform import` won't be able to set them. Gets values from the ID.
	if state.ID.ValueString() != "" {
		var parts [1]string
		for i, v := range strings.SplitN(state.ID.ValueString(), "/", 1) {
			parts[i] = v
		}
		if state.OrganizationID.ValueString() == "" {
			state.OrganizationID = types.StringValue(parts[0])
		}
	}
	state.SetID(state.OrganizationID.ValueString())
	return nil
}

func flattenUserGroups(ctx context.Context, api *apiModelUserGroups) (*tfModelUserGroups, diag.Diagnostics) {
	state := new(tfModelUserGroups)
	if api.CreateTime != nil {
		state.CreateTime = util.StringPointerValue(api.CreateTime)
	}
	if api.Description != nil {
		state.Description = util.StringPointerValue(api.Description)
	}
	if api.ManagedByScim != nil {
		state.ManagedByScim = types.BoolPointerValue(api.ManagedByScim)
	}
	if api.MemberCount != nil {
		state.MemberCount = types.Int64PointerValue(api.MemberCount)
	}
	if api.UpdateTime != nil {
		state.UpdateTime = util.StringPointerValue(api.UpdateTime)
	}
	if api.UserGroupID != nil {
		state.UserGroupID = util.StringPointerValue(api.UserGroupID)
	}
	if api.UserGroupName != nil {
		state.UserGroupName = util.StringPointerValue(api.UserGroupName)
	}
	return state, nil
}

func attrsUserGroups() types.ObjectType {
	return types.ObjectType{AttrTypes: map[string]attr.Type{
		"create_time":     types.StringType,
		"description":     types.StringType,
		"managed_by_scim": types.BoolType,
		"member_count":    types.Int64Type,
		"update_time":     types.StringType,
		"user_group_id":   types.StringType,
		"user_group_name": types.StringType,
	}}
}
