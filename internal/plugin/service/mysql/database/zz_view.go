// Copyright (c) 2026 Aiven, Helsinki, Finland. https://aiven.io/
// Code generated by user config generator. DO NOT EDIT.

package database

import (
	"context"

	avngen "github.com/aiven/go-client-codegen"
	"github.com/aiven/go-client-codegen/handler/service"
	"github.com/hashicorp/terraform-plugin-framework/diag"

	"github.com/aiven/terraform-provider-aiven/internal/plugin/adapter"
	"github.com/aiven/terraform-provider-aiven/internal/plugin/errmsg"
)

var ResourceOptions = adapter.ResourceOptions[*resourceModel, tfModel]{
	Create:                createView,
	Delete:                deleteView,
	IDFields:              idFields(),
	Read:                  readView,
	RefreshState:          true,
	RemoveMissing:         true,
	Schema:                resourceSchema,
	TerminationProtection: true,
	TypeName:              typeName,
}

var DataSourceOptions = adapter.DataSourceOptions[*datasourceModel, tfModel]{
	Read:     readView,
	Schema:   datasourceSchema,
	TypeName: typeName,
}

func createView(ctx context.Context, client avngen.Client, plan *tfModel) diag.Diagnostics {
	var diags diag.Diagnostics
	func() {
		var req service.ServiceDatabaseCreateIn
		diags.Append(expandData(ctx, plan, nil, &req)...)
		if diags.HasError() {
			return
		}

		err := client.ServiceDatabaseCreate(ctx, plan.Project.ValueString(), plan.ServiceName.ValueString(), &req)
		if err != nil {
			diags.Append(errmsg.FromError("ServiceDatabaseCreate Error", err))
			return
		}
	}()
	return diags
}

func readView(ctx context.Context, client avngen.Client, state *tfModel) diag.Diagnostics {
	var diags diag.Diagnostics
	func() {
		rsp, err := client.ServiceDatabaseList(ctx, state.Project.ValueString(), state.ServiceName.ValueString())
		if err != nil {
			diags.Append(errmsg.FromError("ServiceDatabaseList Error", err))
			return
		}
		for _, v := range rsp {
			if v.DatabaseName == state.DatabaseName.ValueString() {
				diags.Append(flattenData(ctx, state, &v)...)
				return
			}
		}
		diags.Append(errmsg.FromError("Resource Not Found", avngen.Error{
			Message:     "`aiven_mysql_database` with given `database_name` not found",
			OperationID: "ServiceDatabaseList",
			Status:      404,
		}))
	}()
	return diags
}

func deleteView(ctx context.Context, client avngen.Client, state *tfModel) diag.Diagnostics {
	var diags diag.Diagnostics
	func() {
		err := client.ServiceDatabaseDelete(ctx, state.Project.ValueString(), state.ServiceName.ValueString(), state.DatabaseName.ValueString())
		if err != nil {
			diags.Append(errmsg.FromError("ServiceDatabaseDelete Error", err))
			return
		}
	}()
	return diags
}
