// Copyright (c) 2026 Aiven, Helsinki, Finland. https://aiven.io/
// Code generated by user config generator. DO NOT EDIT.

package awsprovision

import (
	"context"
	"fmt"
	"github.com/aiven/terraform-provider-aiven/internal/plugin/util"
	"github.com/hashicorp/terraform-plugin-framework/attr"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
	"path/filepath"
	"strings"
)

const typeName = "aiven_byoc_aws_provision"

type tfModel struct {
	ID                                      types.String `tfsdk:"id"`
	AivenAssumeRoleExternalID               types.String `tfsdk:"aiven_assume_role_external_id"`
	AivenAwsAccountPrincipal                types.String `tfsdk:"aiven_aws_account_principal"`
	AivenManagementCidrBlocks               types.Set    `tfsdk:"aiven_management_cidr_blocks"`
	AivenObjectStorageCredentialsCreatorArn types.String `tfsdk:"aiven_object_storage_credentials_creator_arn"`
	AivenObjectStorageUserArn               types.String `tfsdk:"aiven_object_storage_user_arn"`
	AwsIamRoleArn                           types.String `tfsdk:"aws_iam_role_arn"`
	BucketNames                             types.Map    `tfsdk:"bucket_names"`
	ByocName                                types.String `tfsdk:"byoc_name"`
	CloudProvider                           types.String `tfsdk:"cloud_provider"`
	CloudRegion                             types.String `tfsdk:"cloud_region"`
	ContactEmails                           types.Set    `tfsdk:"contact_emails"`
	CustomCloudEnvironmentID                types.String `tfsdk:"custom_cloud_environment_id"`
	CustomCloudNames                        types.Set    `tfsdk:"custom_cloud_names"`
	CustomTags                              types.Map    `tfsdk:"custom_tags"`
	DeploymentModel                         types.String `tfsdk:"deployment_model"`
	DisplayName                             types.String `tfsdk:"display_name"`
	Errors                                  types.Set    `tfsdk:"errors"`
	OrganizationID                          types.String `tfsdk:"organization_id"`
	ReservedCidr                            types.String `tfsdk:"reserved_cidr"`
	State                                   types.String `tfsdk:"state"`
	UpdateTime                              types.String `tfsdk:"update_time"`
	UseCustomerOwnedStorage                 types.Bool   `tfsdk:"use_customer_owned_storage"`
}

func (tf *tfModel) SetID(vOrganizationID string, vCustomCloudEnvironmentID string) {
	tf.OrganizationID = types.StringValue(vOrganizationID)
	tf.CustomCloudEnvironmentID = types.StringValue(vCustomCloudEnvironmentID)
	tf.ID = types.StringValue(filepath.Join(vOrganizationID, vCustomCloudEnvironmentID))
}

type tfModelContactEmails struct {
	Email    types.String `tfsdk:"email"`
	RealName types.String `tfsdk:"real_name"`
	Role     types.String `tfsdk:"role"`
}

type tfModelErrors struct {
	Category types.String `tfsdk:"category"`
	Message  types.String `tfsdk:"message"`
}

type apiModel struct {
	AivenAssumeRoleExternalID               *string                   `json:"aiven_aws_assume_role_external_id,omitempty"`
	AivenAwsAccountPrincipal                *string                   `json:"aiven_aws_account_principal,omitempty"`
	AivenManagementCidrBlocks               *[]string                 `json:"aiven_management_cidr_blocks,omitempty"`
	AivenObjectStorageCredentialsCreatorArn *string                   `json:"aiven_aws_object_storage_credentials_creator_arn,omitempty"`
	AivenObjectStorageUserArn               *string                   `json:"aiven_aws_object_storage_user_arn,omitempty"`
	AwsIamRoleArn                           *string                   `json:"aws_iam_role_arn,omitempty"`
	BucketNames                             *map[string]*string       `json:"bucket_names,omitempty"`
	ByocName                                *string                   `json:"byoc_unique_name,omitempty"`
	CloudProvider                           *string                   `json:"cloud_provider,omitempty"`
	CloudRegion                             *string                   `json:"cloud_region,omitempty"`
	ContactEmails                           *[]*apiModelContactEmails `json:"contact_emails,omitempty"`
	CustomCloudEnvironmentID                *string                   `json:"custom_cloud_environment_id,omitempty"`
	CustomCloudNames                        *[]string                 `json:"custom_cloud_names,omitempty"`
	CustomTags                              *map[string]*string       `json:"byoc_resource_tags,omitempty"`
	DeploymentModel                         *string                   `json:"deployment_model,omitempty"`
	DisplayName                             *string                   `json:"display_name,omitempty"`
	Errors                                  *[]*apiModelErrors        `json:"errors,omitempty"`
	OrganizationID                          *string                   `json:"organization_id,omitempty"`
	ReservedCidr                            *string                   `json:"reserved_cidr,omitempty"`
	State                                   *string                   `json:"state,omitempty"`
	UpdateTime                              *string                   `json:"update_time,omitempty"`
	UseCustomerOwnedStorage                 *bool                     `json:"use_customer_owned_storage,omitempty"`
}

type apiModelContactEmails struct {
	Email    *string `json:"email,omitempty"`
	RealName *string `json:"real_name,omitempty"`
	Role     *string `json:"role,omitempty"`
}

type apiModelErrors struct {
	Category *string `json:"category,omitempty"`
	Message  *string `json:"message,omitempty"`
}

// idFields the ID attribute fields, i.e.:
// terraform import aiven_byoc_aws_provision.foo ORGANIZATION_ID/CUSTOM_CLOUD_ENVIRONMENT_ID
func idFields() []string {
	return []string{"organization_id", "custom_cloud_environment_id"}
}

// expandData turns TF object into Request
func expandData[R any](ctx context.Context, plan, state *tfModel, req *R, modifiers ...util.MapModifier[tfModel]) diag.Diagnostics {
	api := new(apiModel)
	if !plan.AwsIamRoleArn.IsNull() || state != nil && !state.AwsIamRoleArn.IsNull() {
		vAwsIamRoleArn := plan.AwsIamRoleArn.ValueString()
		api.AwsIamRoleArn = &vAwsIamRoleArn
	}
	if !plan.CustomCloudEnvironmentID.IsNull() || state != nil && !state.CustomCloudEnvironmentID.IsNull() {
		vCustomCloudEnvironmentID := plan.CustomCloudEnvironmentID.ValueString()
		api.CustomCloudEnvironmentID = &vCustomCloudEnvironmentID
	}
	if !plan.OrganizationID.IsNull() || state != nil && !state.OrganizationID.IsNull() {
		vOrganizationID := plan.OrganizationID.ValueString()
		api.OrganizationID = &vOrganizationID
	}
	err := util.Remarshal(api, req, plan, modifiers...)
	if err != nil {
		var diags diag.Diagnostics
		diags.AddError("Remarshal error", fmt.Sprintf("Failed to remarshal dtoModel to Request: %s", err.Error()))
		return diags
	}
	return nil
}

func expandContactEmails(ctx context.Context, plan *tfModelContactEmails) (*apiModelContactEmails, diag.Diagnostics) {
	api := new(apiModelContactEmails)
	return api, nil
}

func expandErrors(ctx context.Context, plan *tfModelErrors) (*apiModelErrors, diag.Diagnostics) {
	api := new(apiModelErrors)
	return api, nil
}

// flattenData turns Response into TF object
func flattenData[R any](ctx context.Context, state *tfModel, rsp *R, modifiers ...util.MapModifier[tfModel]) diag.Diagnostics {
	api := new(apiModel)
	err := util.Remarshal(rsp, api, state, modifiers...)
	if err != nil {
		var diags diag.Diagnostics
		diags.AddError("Remarshal error", fmt.Sprintf("Failed to remarshal Response to dtoModel: %s", err.Error()))
		return diags
	}
	if api.AivenManagementCidrBlocks != nil {
		vAivenManagementCidrBlocks, diags := util.SetValueFrom(ctx, types.StringType, api.AivenManagementCidrBlocks)
		if diags.HasError() {
			return diags
		}
		state.AivenManagementCidrBlocks = vAivenManagementCidrBlocks
	}
	if api.BucketNames != nil {
		vBucketNames, diags := util.MapValueFrom(ctx, types.StringType, api.BucketNames)
		if diags.HasError() {
			return diags
		}
		state.BucketNames = vBucketNames
	}
	if api.ContactEmails != nil {
		vContactEmails, diags := util.FlattenSetNested(ctx, flattenContactEmails, *api.ContactEmails, attrsContactEmails())
		if diags.HasError() {
			return diags
		}
		state.ContactEmails = vContactEmails
	}
	if api.CustomCloudNames != nil {
		vCustomCloudNames, diags := util.SetValueFrom(ctx, types.StringType, api.CustomCloudNames)
		if diags.HasError() {
			return diags
		}
		state.CustomCloudNames = vCustomCloudNames
	}
	if api.CustomTags != nil {
		vCustomTags, diags := util.MapValueFrom(ctx, types.StringType, api.CustomTags)
		if diags.HasError() {
			return diags
		}
		state.CustomTags = vCustomTags
	}
	if api.Errors != nil {
		vErrors, diags := util.FlattenSetNested(ctx, flattenErrors, *api.Errors, attrsErrors())
		if diags.HasError() {
			return diags
		}
		state.Errors = vErrors
	}
	if api.AivenAssumeRoleExternalID != nil || state.AivenAssumeRoleExternalID.IsUnknown() {
		state.AivenAssumeRoleExternalID = util.StringPointerValue(api.AivenAssumeRoleExternalID)
	}
	if api.AivenAwsAccountPrincipal != nil || state.AivenAwsAccountPrincipal.IsUnknown() {
		state.AivenAwsAccountPrincipal = util.StringPointerValue(api.AivenAwsAccountPrincipal)
	}
	if api.AivenObjectStorageCredentialsCreatorArn != nil || state.AivenObjectStorageCredentialsCreatorArn.IsUnknown() {
		state.AivenObjectStorageCredentialsCreatorArn = util.StringPointerValue(api.AivenObjectStorageCredentialsCreatorArn)
	}
	if api.AivenObjectStorageUserArn != nil || state.AivenObjectStorageUserArn.IsUnknown() {
		state.AivenObjectStorageUserArn = util.StringPointerValue(api.AivenObjectStorageUserArn)
	}
	if api.AwsIamRoleArn != nil && !state.AwsIamRoleArn.IsUnknown() {
		state.AwsIamRoleArn = util.StringPointerValue(api.AwsIamRoleArn)
	}
	if api.ByocName != nil || state.ByocName.IsUnknown() {
		state.ByocName = util.StringPointerValue(api.ByocName)
	}
	if api.CloudProvider != nil || state.CloudProvider.IsUnknown() {
		state.CloudProvider = util.StringPointerValue(api.CloudProvider)
	}
	if api.CloudRegion != nil || state.CloudRegion.IsUnknown() {
		state.CloudRegion = util.StringPointerValue(api.CloudRegion)
	}
	if api.CustomCloudEnvironmentID != nil && !state.CustomCloudEnvironmentID.IsUnknown() {
		state.CustomCloudEnvironmentID = util.StringPointerValue(api.CustomCloudEnvironmentID)
	}
	if api.DeploymentModel != nil || state.DeploymentModel.IsUnknown() {
		state.DeploymentModel = util.StringPointerValue(api.DeploymentModel)
	}
	if api.DisplayName != nil || state.DisplayName.IsUnknown() {
		state.DisplayName = util.StringPointerValue(api.DisplayName)
	}
	if api.OrganizationID != nil && !state.OrganizationID.IsUnknown() {
		state.OrganizationID = util.StringPointerValue(api.OrganizationID)
	}
	if api.ReservedCidr != nil || state.ReservedCidr.IsUnknown() {
		state.ReservedCidr = util.StringPointerValue(api.ReservedCidr)
	}
	if api.State != nil || state.State.IsUnknown() {
		state.State = util.StringPointerValue(api.State)
	}
	if api.UpdateTime != nil || state.UpdateTime.IsUnknown() {
		state.UpdateTime = util.StringPointerValue(api.UpdateTime)
	}
	if api.UseCustomerOwnedStorage != nil || state.UseCustomerOwnedStorage.IsUnknown() {
		state.UseCustomerOwnedStorage = types.BoolPointerValue(api.UseCustomerOwnedStorage)
	}
	// Response may not contain ID fields.
	// In that case, `terraform import` won't be able to set them. Gets values from the ID.
	if state.ID.ValueString() != "" {
		var parts [2]string
		for i, v := range strings.SplitN(state.ID.ValueString(), "/", 2) {
			parts[i] = v
		}
		if state.OrganizationID.ValueString() == "" {
			state.OrganizationID = types.StringValue(parts[0])
		}
		if state.CustomCloudEnvironmentID.ValueString() == "" {
			state.CustomCloudEnvironmentID = types.StringValue(parts[1])
		}
	}
	state.SetID(state.OrganizationID.ValueString(), state.CustomCloudEnvironmentID.ValueString())
	return nil
}

func flattenContactEmails(ctx context.Context, api *apiModelContactEmails) (*tfModelContactEmails, diag.Diagnostics) {
	state := new(tfModelContactEmails)
	if api.Email != nil {
		state.Email = util.StringPointerValue(api.Email)
	}
	if api.RealName != nil {
		state.RealName = util.StringPointerValue(api.RealName)
	}
	if api.Role != nil {
		state.Role = util.StringPointerValue(api.Role)
	}
	return state, nil
}

func flattenErrors(ctx context.Context, api *apiModelErrors) (*tfModelErrors, diag.Diagnostics) {
	state := new(tfModelErrors)
	if api.Category != nil {
		state.Category = util.StringPointerValue(api.Category)
	}
	if api.Message != nil {
		state.Message = util.StringPointerValue(api.Message)
	}
	return state, nil
}

func attrsContactEmails() types.ObjectType {
	return types.ObjectType{AttrTypes: map[string]attr.Type{
		"email":     types.StringType,
		"real_name": types.StringType,
		"role":      types.StringType,
	}}
}

func attrsErrors() types.ObjectType {
	return types.ObjectType{AttrTypes: map[string]attr.Type{
		"category": types.StringType,
		"message":  types.StringType,
	}}
}
