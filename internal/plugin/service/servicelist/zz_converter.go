// Copyright (c) 2026 Aiven, Helsinki, Finland. https://aiven.io/
// Code generated by user config generator. DO NOT EDIT.

package servicelist

import (
	"context"
	"fmt"
	"path/filepath"
	"strings"

	"github.com/hashicorp/terraform-plugin-framework/attr"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"

	"github.com/aiven/terraform-provider-aiven/internal/plugin/util"
)

const typeName = "aiven_service_list"

type tfModel struct {
	ID       types.String `tfsdk:"id"`
	Project  types.String `tfsdk:"project"`
	Services types.List   `tfsdk:"services"`
}

func (tf *tfModel) SetID(vProject string) {
	tf.Project = types.StringValue(vProject)
	tf.ID = types.StringValue(filepath.Join(vProject))
}

type tfModelServices struct {
	CloudDescription       types.String  `tfsdk:"cloud_description"`
	CloudName              types.String  `tfsdk:"cloud_name"`
	CreateTime             types.String  `tfsdk:"create_time"`
	DiskSpaceMb            types.Int64   `tfsdk:"disk_space_mb"`
	NodeCount              types.Int64   `tfsdk:"node_count"`
	NodeCPUCount           types.Int64   `tfsdk:"node_cpu_count"`
	NodeMemoryMb           types.Float64 `tfsdk:"node_memory_mb"`
	Plan                   types.String  `tfsdk:"plan"`
	ProjectVpcID           types.String  `tfsdk:"project_vpc_id"`
	ServiceName            types.String  `tfsdk:"service_name"`
	ServiceType            types.String  `tfsdk:"service_type"`
	ServiceTypeDescription types.String  `tfsdk:"service_type_description"`
	ServiceURI             types.String  `tfsdk:"service_uri"`
	State                  types.String  `tfsdk:"state"`
	TerminationProtection  types.Bool    `tfsdk:"termination_protection"`
	UpdateTime             types.String  `tfsdk:"update_time"`
}

type apiModel struct {
	Project  *string              `json:"project,omitempty"`
	Services *[]*apiModelServices `json:"services,omitempty"`
}

type apiModelServices struct {
	CloudDescription       *string  `json:"cloud_description,omitempty"`
	CloudName              *string  `json:"cloud_name,omitempty"`
	CreateTime             *string  `json:"create_time,omitempty"`
	DiskSpaceMb            *int64   `json:"disk_space_mb,omitempty"`
	NodeCount              *int64   `json:"node_count,omitempty"`
	NodeCPUCount           *int64   `json:"node_cpu_count,omitempty"`
	NodeMemoryMb           *float64 `json:"node_memory_mb,omitempty"`
	Plan                   *string  `json:"plan,omitempty"`
	ProjectVpcID           *string  `json:"project_vpc_id,omitempty"`
	ServiceName            *string  `json:"service_name,omitempty"`
	ServiceType            *string  `json:"service_type,omitempty"`
	ServiceTypeDescription *string  `json:"service_type_description,omitempty"`
	ServiceURI             *string  `json:"service_uri,omitempty"`
	State                  *string  `json:"state,omitempty"`
	TerminationProtection  *bool    `json:"termination_protection,omitempty"`
	UpdateTime             *string  `json:"update_time,omitempty"`
}

// flattenData turns Response into TF object
func flattenData[R any](ctx context.Context, state *tfModel, rsp *R, modifiers ...util.MapModifier[tfModel]) diag.Diagnostics {
	api := new(apiModel)
	err := util.Remarshal(rsp, api, state, modifiers...)
	if err != nil {
		var diags diag.Diagnostics
		diags.AddError("Remarshal error", fmt.Sprintf("Failed to remarshal Response to dtoModel: %s", err.Error()))
		return diags
	}
	if api.Services != nil || state.Services.IsUnknown() || state.Services.IsNull() {
		vServices, diags := util.FlattenListNested(ctx, flattenServices, *api.Services, attrsServices())
		if diags.HasError() {
			return diags
		}
		state.Services = vServices
	}
	if api.Project != nil && !state.Project.IsUnknown() {
		state.Project = util.StringPointerValue(api.Project)
	}
	// Response may not contain ID fields.
	// In that case, `terraform import` won't be able to set them. Gets values from the ID.
	if state.ID.ValueString() != "" {
		var parts [1]string
		for i, v := range strings.SplitN(state.ID.ValueString(), "/", 1) {
			parts[i] = v
		}
		if state.Project.ValueString() == "" {
			state.Project = types.StringValue(parts[0])
		}
	}
	state.SetID(state.Project.ValueString())
	return nil
}

func flattenServices(ctx context.Context, api *apiModelServices) (*tfModelServices, diag.Diagnostics) {
	state := new(tfModelServices)
	if api.CloudDescription != nil || state.CloudDescription.IsUnknown() {
		state.CloudDescription = util.StringPointerValue(api.CloudDescription)
	}
	if api.CloudName != nil || state.CloudName.IsUnknown() {
		state.CloudName = util.StringPointerValue(api.CloudName)
	}
	if api.CreateTime != nil || state.CreateTime.IsUnknown() {
		state.CreateTime = util.StringPointerValue(api.CreateTime)
	}
	if api.DiskSpaceMb != nil || state.DiskSpaceMb.IsUnknown() {
		state.DiskSpaceMb = types.Int64PointerValue(api.DiskSpaceMb)
	}
	if api.NodeCount != nil || state.NodeCount.IsUnknown() {
		state.NodeCount = types.Int64PointerValue(api.NodeCount)
	}
	if api.NodeCPUCount != nil || state.NodeCPUCount.IsUnknown() {
		state.NodeCPUCount = types.Int64PointerValue(api.NodeCPUCount)
	}
	if api.NodeMemoryMb != nil || state.NodeMemoryMb.IsUnknown() {
		state.NodeMemoryMb = types.Float64PointerValue(api.NodeMemoryMb)
	}
	if api.Plan != nil || state.Plan.IsUnknown() {
		state.Plan = util.StringPointerValue(api.Plan)
	}
	if api.ProjectVpcID != nil || state.ProjectVpcID.IsUnknown() {
		state.ProjectVpcID = util.StringPointerValue(api.ProjectVpcID)
	}
	if api.ServiceName != nil || state.ServiceName.IsUnknown() {
		state.ServiceName = util.StringPointerValue(api.ServiceName)
	}
	if api.ServiceType != nil || state.ServiceType.IsUnknown() {
		state.ServiceType = util.StringPointerValue(api.ServiceType)
	}
	if api.ServiceTypeDescription != nil || state.ServiceTypeDescription.IsUnknown() {
		state.ServiceTypeDescription = util.StringPointerValue(api.ServiceTypeDescription)
	}
	if api.ServiceURI != nil || state.ServiceURI.IsUnknown() {
		state.ServiceURI = util.StringPointerValue(api.ServiceURI)
	}
	if api.State != nil || state.State.IsUnknown() {
		state.State = util.StringPointerValue(api.State)
	}
	if api.TerminationProtection != nil || state.TerminationProtection.IsUnknown() {
		state.TerminationProtection = types.BoolPointerValue(api.TerminationProtection)
	}
	if api.UpdateTime != nil || state.UpdateTime.IsUnknown() {
		state.UpdateTime = util.StringPointerValue(api.UpdateTime)
	}
	return state, nil
}

func attrsServices() types.ObjectType {
	return types.ObjectType{AttrTypes: map[string]attr.Type{
		"cloud_description":        types.StringType,
		"cloud_name":               types.StringType,
		"create_time":              types.StringType,
		"disk_space_mb":            types.Int64Type,
		"node_count":               types.Int64Type,
		"node_cpu_count":           types.Int64Type,
		"node_memory_mb":           types.Float64Type,
		"plan":                     types.StringType,
		"project_vpc_id":           types.StringType,
		"service_name":             types.StringType,
		"service_type":             types.StringType,
		"service_type_description": types.StringType,
		"service_uri":              types.StringType,
		"state":                    types.StringType,
		"termination_protection":   types.BoolType,
		"update_time":              types.StringType,
	}}
}
