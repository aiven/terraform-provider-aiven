// Copyright (c) 2026 Aiven, Helsinki, Finland. https://aiven.io/
// Code generated by user config generator. DO NOT EDIT.

package cmk

import (
	"context"
	"fmt"
	"path/filepath"
	"strings"

	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"

	"github.com/aiven/terraform-provider-aiven/internal/plugin/util"
)

const typeName = "aiven_cmk"

type tfModel struct {
	ID          types.String `tfsdk:"id"`
	CmkID       types.String `tfsdk:"cmk_id"`
	CmkProvider types.String `tfsdk:"cmk_provider"`
	CreatedAt   types.String `tfsdk:"created_at"`
	DefaultCmk  types.Bool   `tfsdk:"default_cmk"`
	Project     types.String `tfsdk:"project"`
	Resource    types.String `tfsdk:"resource"`
	Status      types.String `tfsdk:"status"`
	UpdatedAt   types.String `tfsdk:"updated_at"`
}

func (tf *tfModel) SetID(vProject string, vCmkID string) {
	tf.Project = types.StringValue(vProject)
	tf.CmkID = types.StringValue(vCmkID)
	tf.ID = types.StringValue(filepath.Join(vProject, vCmkID))
}

type apiModel struct {
	CmkID       *string `json:"id,omitempty"`
	CmkProvider *string `json:"provider,omitempty"`
	CreatedAt   *string `json:"created_at,omitempty"`
	DefaultCmk  *bool   `json:"default_cmk,omitempty"`
	Project     *string `json:"project,omitempty"`
	Resource    *string `json:"resource,omitempty"`
	Status      *string `json:"status,omitempty"`
	UpdatedAt   *string `json:"updated_at,omitempty"`
}

// idFields the ID attribute fields, i.e.:
// terraform import aiven_cmk.foo PROJECT/CMK_ID
func idFields() []string {
	return []string{"project", "cmk_id"}
}

// expandData turns TF object into Request
func expandData[R any](ctx context.Context, plan, state *tfModel, req *R, modifiers ...util.MapModifier[tfModel]) diag.Diagnostics {
	api := new(apiModel)
	if !plan.CmkProvider.IsNull() || state != nil && !state.CmkProvider.IsNull() {
		vCmkProvider := plan.CmkProvider.ValueString()
		api.CmkProvider = &vCmkProvider
	}
	if !plan.DefaultCmk.IsNull() || state != nil && !state.DefaultCmk.IsNull() {
		vDefaultCmk := plan.DefaultCmk.ValueBool()
		api.DefaultCmk = &vDefaultCmk
	}
	if !plan.Project.IsNull() || state != nil && !state.Project.IsNull() {
		vProject := plan.Project.ValueString()
		api.Project = &vProject
	}
	if !plan.Resource.IsNull() || state != nil && !state.Resource.IsNull() {
		vResource := plan.Resource.ValueString()
		api.Resource = &vResource
	}
	err := util.Remarshal(api, req, plan, modifiers...)
	if err != nil {
		var diags diag.Diagnostics
		diags.AddError("Remarshal error", fmt.Sprintf("Failed to remarshal dtoModel to Request: %s", err.Error()))
		return diags
	}
	return nil
}

// flattenData turns Response into TF object
func flattenData[R any](ctx context.Context, state *tfModel, rsp *R, modifiers ...util.MapModifier[tfModel]) diag.Diagnostics {
	api := new(apiModel)
	err := util.Remarshal(rsp, api, state, modifiers...)
	if err != nil {
		var diags diag.Diagnostics
		diags.AddError("Remarshal error", fmt.Sprintf("Failed to remarshal Response to dtoModel: %s", err.Error()))
		return diags
	}
	if api.CmkID != nil || state.CmkID.IsUnknown() {
		state.CmkID = util.StringPointerValue(api.CmkID)
	}
	if api.CmkProvider != nil && !state.CmkProvider.IsUnknown() {
		state.CmkProvider = util.StringPointerValue(api.CmkProvider)
	}
	if api.CreatedAt != nil || state.CreatedAt.IsUnknown() {
		state.CreatedAt = util.StringPointerValue(api.CreatedAt)
	}
	if api.DefaultCmk != nil && !state.DefaultCmk.IsUnknown() {
		state.DefaultCmk = types.BoolPointerValue(api.DefaultCmk)
	}
	if api.Project != nil && !state.Project.IsUnknown() {
		state.Project = util.StringPointerValue(api.Project)
	}
	if api.Resource != nil && !state.Resource.IsUnknown() {
		state.Resource = util.StringPointerValue(api.Resource)
	}
	if api.Status != nil || state.Status.IsUnknown() {
		state.Status = util.StringPointerValue(api.Status)
	}
	if api.UpdatedAt != nil || state.UpdatedAt.IsUnknown() {
		state.UpdatedAt = util.StringPointerValue(api.UpdatedAt)
	}
	// Response may not contain ID fields.
	// In that case, `terraform import` won't be able to set them. Gets values from the ID.
	if state.ID.ValueString() != "" {
		var parts [2]string
		for i, v := range strings.SplitN(state.ID.ValueString(), "/", 2) {
			parts[i] = v
		}
		if state.Project.ValueString() == "" {
			state.Project = types.StringValue(parts[0])
		}
		if state.CmkID.ValueString() == "" {
			state.CmkID = types.StringValue(parts[1])
		}
	}
	state.SetID(state.Project.ValueString(), state.CmkID.ValueString())
	return nil
}
