# yaml-language-server: $schema=https://json-schema.org/draft/2020-12/schema

type: object
$comment: |
  This schema defines the structure for configuring Terraform provider resources and datasources.
  Use this file to specify how your provider's resources and datasources should behave.
properties:
  version:
    type: integer
    $comment: |
      Specifies the version/generation of the resource schema.
      Usually you don't need to set this.
  beta:
    type: boolean
    $comment: |
      Set to true if this resource/datasource is in beta and may have breaking changes.
  legacyTimeouts:
    type: boolean
    $comment: |
      Set to true to use legacy timeout handling for this resource.
      This is only needed for SDKv2 compatibility.
  datasource:
    $ref: '#/definitions/SchemaMeta'
    $comment: |
      Documentation and configuration specific to this datasource.
      Use this to provide clear descriptions for your datasource in the Terraform registry.
  remove:
    $ref: '#/definitions/Remove'
    $comment: |
      List of attributes to remove from the resource/datasource.
      Example: remove: ["openapi_name1", "openapi_name2"]
  idAttribute:
    $ref: '#/definitions/IDAttribute'
    $comment: |
      Defines how the unique identifier (`id` field) for this resource is constructed.
      This ID is used by Terraform to import the resource.
  location:
    type: string
    $comment: |
      Specifies the file path where the resource package is located.
      Example: location: "internal/plugin/service/organization"
  operations:
    type: array
    $comment: |
      A list of CRUD operations supported by this resource.
      Each entry specifies an operation, with its OpenAPI ID, type, and result extraction instructions.
    items:
      $ref: '#/definitions/Operation'
  rename:
    $ref: '#/definitions/Rename'
    $comment: |
      List of attributes to rename in the resource/datasource.
      Example: rename: {"old_openapi_name": "new_terraform_name"}
  resource:
    $ref: '#/definitions/SchemaMeta'
    $comment: |
      Documentation and configuration specific to this resource type.
      Use this to provide clear descriptions for your resource in the Terraform registry.
  schema:
    $ref: '#/definitions/Schema'
    $comment: |
      Configuration for the resource/datasource schema.
      Use this to override the schema from the OpenAPI spec or add new fields.

  clientHandler:
    type: string
    $comment: |
      The name of the client package to use for this resource/datasource.
      Example: clientHandler: "organization"
  refreshState:
    type: boolean
    $comment: |
      Set to true to refresh the state after the resource is created/updated/deleted.
      Example: refreshState: true
required:
  - location
  - idAttribute
  - operations
additionalProperties: false

definitions:
  Remove:
    type: array
    items:
      type: string
      $comment: The attribute to remove

  IDAttribute:
    type: object
    $comment: Configuration for how resource IDs are structured and managed
    properties:
      fields:
        type: array
        items:
          type: string
        $comment: |
          List of resource attributes that form the unique identifier.
          Example: ["project_id", "instance_name"] would create an ID like "project-123/instance-456"
      description:
        type: string
        $comment: |
          Explains how the ID is formatted and what each part represents.
          Set if the default (generated) description is not enough.
          Example: The organization ID.
      mutable:
        type: boolean
        $comment: |
          Set to true if the ID components can be changed after resource creation.
          Most resources should not set this.
          When set to true, it doesn't generate the `UseStateForUnknown` plan modifier. 
    required:
      - fields
    additionalProperties: false

  Operation:
    type: object
    $comment: |
      Aiven OperationID and CRUD operation pairs.
    properties:
      id:
        type: string
        $comment: The operation's unique identifier, e.g. "OrganizationCreate"
      type:
        type: string
        enum: ["create", "read", "update", "delete", "upsert"]
        $comment: The type of operation (create, read, update, delete, upsert)
      disableView:
        type: boolean
        $comment: Set to true to disable view generation for this specific operation
      resultKey:
        type: string
        $comment: |
          The key to extract the result object from the response (if the API nests result under a property)
          E.g.: resultKey: "result" retrieves response.result
      resultListLookupKeys:
        type: array
        items:
          type: string
        $comment: |
          When the response returns a list, these keys are used to locate the item within the response
      resultListToKey:
        type: string
        $comment: |
          Specifies the key to map list responses into a single object for flatten/expand logic
    required:
      - id
      - type
    additionalProperties: false
  SchemaMeta:
    type: object
    $comment: Metadata for the resource/datasource
    properties:
      deprecationMessage:
        type: string
        $comment: |
          Message to inform users that this resource/datasource will be removed in a future version.
          Example: "This resource will be removed in version 3.0.0. Use postgresql_v2 instead."
      description:
        type: string
        $comment: |
          Detailed description of what this resource/datasource does and how to use it.
          This appears in the Terraform registry documentation.
          Example: "Manages PostgreSQL database instance"
    required:
      - description

  Rename:
    type: object
    $comment: Configuration for renaming OpenAPI schema attributes
    properties:
      rename:
        type: string
        $comment: New name for the attribute

  Schema:
    type: object
    $comment: Configuration for modifying resource attributes
    properties:
      jsonName:
        type: string
        $comment: The name of the attribute in the JSON schema
      computed:
        type: boolean
        $comment: |
          Set to true if this attribute's value is determined by the provider/API.
      useStateForUnknown:
        type: boolean
        $comment: |
          During the planning phase Terraform shows "known after apply" for computed attributes.
          Set this to true if the attribute's value should be taken from the current state during planning.
      default:
        type: any
        $comment: Default value for this attribute
      deprecationMessage:
        type: string
        $comment: |
          Message indicating this attribute will be removed in a future version.
          Example: "Use 'new_attribute' instead"
      description:
        type: string
        $comment: |
          Updated description for the attribute.
          Example: "The size of the instance in GB"
      items:
        type: object
        $comment: Array item or Map item configuration
      enum:
        type: array
        items:
          type: any
        $comment: List of allowed values for this attribute
      forceNew:
        type: boolean
        $comment: Set to true if changes to this attribute destroy the resource
      maximum:
        type: integer
        $comment: Maximum allowed value for numeric attributes
      maxItems:
        type: integer
        $comment: Maximum number of items allowed in an array/list
      maxLength:
        type: integer
        $comment: Maximum length allowed for string attributes
      minimum:
        type: integer
        $comment: Minimum allowed value for numeric attributes
      minItems:
        type: integer
        $comment: Minimum number of items required in an array/list
      minLength:
        type: integer
        $comment: Minimum length required for string attributes
      nullable:
        type: boolean
        $comment: Set to true if this attribute can be null. It can't be both nullable and optional.
      optional:
        type: boolean
        $comment: Set to true if this attribute is optional
      properties:
        type: object
        additionalProperties:
          $ref: "#/definitions/Schema"
        $comment: Nested attributes for object types
      required:
        type: boolean
        $comment: Set to true if this attribute must be specified by the user
      sensitive:
        type: boolean
        $comment: |
          Set to true if this attribute contains sensitive data (passwords, tokens).
          Sensitive attributes are masked in console output.
      type:
        type: string
        $comment: The data type of this attribute
        enum:
          - string
          - integer
          - number
          - boolean
          - array
          - arrayOrdered
          - object
      alsoRequires:
        type: array
        items:
          type: string
        $comment: List of other attributes that must be set if this attribute is set
    additionalProperties: false
