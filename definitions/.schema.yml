# yaml-language-server: $schema=https://json-schema.org/draft/2020-12/schema

type: object
$comment: |
  This schema defines the structure for configuring Terraform provider resources and datasources.
  Use this file to specify how your provider's resources and datasources should behave.
properties:
  version:
    type: integer
    $comment: |
      Specifies the version/generation of the resource schema.
      Usually you don't need to set this.
  beta:
    type: boolean
    $comment: |
      Indicates whether this resource or datasource is in beta status.
      If not specified, the beta status may be inferred from OperationID schemas.
  legacyTimeouts:
    type: boolean
    $comment: |
      Set to true to use legacy timeout handling for this resource.
      This is only needed for SDKv2 compatibility.
  resource:
    type: object
    properties:
      description:
        type: string
        description: Description/documentation for this resource type.
      deprecationMessage:
        type: string
        description: Deprecation message for this resource, if applicable.
      terminationProtection:
        type: boolean
        description: |
          Set to true to enable termination protection validation for this resource.
          The `termination_protection` attribute generated automatically.
      refreshState:
        type: boolean
        $comment: |
          Set to true to refresh the state after the resource is created/updated/deleted.
          Example: refreshState: true
    $comment: |
      Documentation and configuration specific to this resource type.
      Use this to provide clear descriptions for your resource in the Terraform registry.
  datasource:
    type: object
    properties:
      description:
        type: string
        description: Description/documentation for this datasource.
      deprecationMessage:
        type: string
        description: Deprecation message for this datasource, if applicable.
      exactlyOneOf:
        type: array
        items:
          type: string
        description: List of fields where exactly one must be configured. Applies to data sources only.
    $comment: |
      Documentation and configuration specific to this datasource.
      Use this to provide clear descriptions for your datasource in the Terraform registry.
  remove:
    $ref: '#/definitions/Remove'
    $comment: |
      List of attributes to remove from the resource/datasource.
      Example: remove: ["openapi_name1", "openapi_name2"]
  idAttributeComposed:
    type: array
    minItems: 1
    items:
      type: string
      $comment: A list of fields to compose the ID attribute from
  location:
    type: string
    $comment: |
      Specifies the file path where the resource package is located.
      Example: location: "internal/plugin/service/organization"
  operations:
    type: array
    $comment: |
      A list of CRUD operations supported by this resource.
      Each entry specifies an operation, with its OpenAPI ID, type, and result extraction instructions.
    items:
      $ref: '#/definitions/Operation'
  rename:
    $ref: '#/definitions/Rename'
    $comment: |
      List of attributes to rename in the resource/datasource.
      Example: rename: {"old_openapi_name": "new_terraform_name"}
  schema:
    $ref: '#/definitions/Schema'
    $comment: |
      Configuration for the resource/datasource schema.
      Use this to override the schema from the OpenAPI spec or add new fields.

  clientHandler:
    type: string
    $comment: |
      The name of the client package to use for this resource/datasource.
      Example: clientHandler: "organization"
  planModifier:
    type: boolean
    $comment: |
      Set to true to use the plan modifier for this resource/datasource. 
      Plan modifier is called before expandModifier and has access to the plan client
  expandModifier:
    type: boolean
  flattenModifier:
    type: boolean
required:
  - location
  - operations
additionalProperties: false

definitions:
  Remove:
    type: array
    items:
      type: string
      $comment: The attribute to remove

  Operation:
    type: object
    $comment: |
      Aiven OperationID and CRUD operation pairs.
    properties:
      id:
        type: string
        $comment: The operation's unique identifier, e.g. "OrganizationCreate"
      type:
        type: string
        enum: ["create", "read", "update", "delete"]
        $comment: The type of operation (create, read, etc.)
      disableView:
        type: boolean
        $comment: Set to true to disable view generation for this specific operation
      resultKey:
        type: string
        $comment: |
          The key to extract the result object from the response (if the API nests result under a property)
          E.g.: resultKey: "result" retrieves response.result
      resultListLookupKeys:
        type: object
        additionalProperties:
          type: string
        $comment: |
          Used to find the correct item in a list response.
          Maps client response field names (key) to Terraform schema attributes (value).
      resultToKey:
        type: string
        $comment: |
          When the API response is not an object (e.g., a primitive or array), wrap it into a map using this key.
    required:
      - id
      - type
    additionalProperties: false

  Rename:
    type: object
    $comment: Configuration for renaming OpenAPI schema attributes
    properties:
      rename:
        type: string
        $comment: New name for the attribute

  Schema:
    type: object
    $comment: Configuration for modifying resource attributes
    properties:
      jsonName:
        type: string
        $comment: The name of the attribute in the JSON schema
      computed:
        type: boolean
        $comment: |
          Set to true if this attribute's value is determined by the provider/API.
      useStateForUnknown:
        type: boolean
        $comment: |
          During the planning phase Terraform shows "known after apply" for computed attributes.
          Set this to true if the attribute's value should be taken from the current state during planning.
      default:
        type: any
        $comment: Default value for this attribute
      deprecationMessage:
        type: string
        $comment: |
          Message indicating this attribute will be removed in a future version.
          Example: "Use 'new_attribute' instead"
      description:
        type: string
        $comment: |
          Updated description for the attribute.
          Example: "The size of the instance in GB"
      items:
        $ref: "#/definitions/Schema"
        $comment: Array item or Map item configuration
      additionalProperties:
        $ref: "#/definitions/Schema"
        $comment: Additional properties for object types
      enum:
        type: array
        items:
          type: any
        $comment: List of allowed values for this attribute
      forceNew:
        type: boolean
        $comment: Set to true if changes to this attribute destroy the resource
      maximum:
        type: integer
        $comment: Maximum allowed value for numeric attributes
      maxItems:
        type: integer
        $comment: Maximum number of items allowed in an array/list
      maxLength:
        type: integer
        $comment: Maximum length allowed for string attributes
      minimum:
        type: integer
        $comment: Minimum allowed value for numeric attributes
      minItems:
        type: integer
        $comment: Minimum number of items required in an array/list
      minLength:
        type: integer
        $comment: Minimum length required for string attributes
      nullable:
        type: boolean
        $comment: Set to true if this attribute can be null. It can't be both nullable and optional.
      optional:
        type: boolean
        $comment: Set to true if this attribute is optional
      writeOnly:
        type: boolean
        $comment: |
          Set to true if this attribute is write-only. See https://developer.hashicorp.com/terraform/plugin/sdkv2/resources/write-only-arguments
      properties:
        type: object
        additionalProperties:
          $ref: "#/definitions/Schema"
        $comment: Nested attributes for object types
      required:
        type: boolean
        $comment: Set to true if this attribute must be specified by the user
      sensitive:
        type: boolean
        $comment: |
          Set to true if this attribute contains sensitive data (passwords, tokens).
          Sensitive attributes are masked in console output.
      type:
        type: string
        $comment: The data type of this attribute
        enum:
          - string
          - integer
          - number
          - boolean
          - array
          - arrayOrdered
          - object
      conflictsWith:
        type: array
        items:
          type: string
        $comment: List of other attributes that cannot be set if this attribute is set
      exactlyOneOf:
        type: array
        items:
          type: string
        $comment: List of attributes of which exactly one must be set
      atLeastOneOf:
        type: array
        items:
          type: string
        $comment: List of attributes of which at least one must be set
      alsoRequires:
        type: array
        items:
          type: string
        $comment: List of other attributes that must also be set if this attribute is set
    additionalProperties: false
