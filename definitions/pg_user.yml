# yaml-language-server: $schema=.schema.yml
location: internal/plugin/service/pg/user
resource:
  refreshState: true
  removeMissing: true
  description: Creates and manages an Aiven for PostgreSQL® service user.
datasource:
  description: Gets information about an Aiven for PostgreSQL® service user.
clientHandler: service
idAttributeComposed: [project, service_name, username]
legacyTimeouts: true
flattenModifier: true
expandModifier: true
operations:
  - id: ServiceUserCreate
    type: create
    resultKey: user
    disableView: true
  - id: ServiceUserDelete
    type: delete
  - id: ServiceUserGet
    type: read
    resultKey: user
rename:
  service_username: username
remove:
  - access_cert_not_valid_after_time
  - access_control
  - authentication
  - expiring_cert_not_valid_after_time
  - password_updated_time
schema:
  type:
    description: The service user account type, either primary or regular.
  service_name:
    description: The name of the service.
  username:
    description: The name of the service user for this service.
  pg_allow_replication:
    type: boolean
    optional: true
    computed: true
    useStateForUnknown: true
    description: Allows replication. For the default avnadmin user this attribute is required and is always `true`.
  password:
    type: string
    optional: true
    sensitive: true
    minimum: 8
    maximum: 256
    conflictsWith: [password_wo]
    description: The password of the service user (auto-generated if not provided).
  password_wo:
    type: string
    optional: true
    writeOnly: true
    sensitive: true
    description: The password of the service user (write-only, not stored in state).
    minimum: 8
    maximum: 256
    conflictsWith: [password]
    alsoRequires: [password_wo_version]
  password_wo_version:
    type: integer
    optional: true
    description: Version number for `password_wo`. Increment this to rotate the password.
    alsoRequires: [password_wo]
    minimum: 1
